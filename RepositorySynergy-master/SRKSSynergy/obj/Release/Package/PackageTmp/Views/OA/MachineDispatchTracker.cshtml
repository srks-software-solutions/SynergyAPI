@model IList<SRKSSynergy.Models.MachineDispatch>

@{
	ViewBag.Title = "Machine Dispatch Tracker";
	Layout = "~/Views/Shared/_Layout.cshtml";
	int slno = 1;
}

@* Paging & Sorting Code  *@

@*@helper buildLinks(int start, int end, string innerContent)
{
	for (int i = start; i <= end; i++)
	{
	<a class="@(i == ViewBag.CurrentPage ? "current" : "")"  href="@Url.Action("OAExisting", "OA", new { page = i, sortBy = ViewBag.sortBy, isAsc = ViewBag.isAsc.ToString().ToLower(), search = ViewBag.Search, cunam = ViewBag.CUNAM })">@(innerContent ?? i.ToString())</a>      
	}
	
}


@helper pageLinks()
{
	const int maxPages = 11;

	if (ViewBag.TotalPages <= maxPages)
	{
	@buildLinks(1, (int)ViewBag.TotalPages, null)
		return;
	}

	int pagesAfter = ViewBag.TotalPages - ViewBag.CurrentPage; // Number of pages after current
	int pagesBefore = ViewBag.CurrentPage - 1; // Number of pages before current

	if (pagesAfter <= 4)
	{
	@buildLinks(1, 1, null) // Show 1st page

		int pageSubset = ViewBag.TotalPages - maxPages - 1 > 1 ? ViewBag.TotalPages - maxPages - 1 : 2;
	@buildLinks(pageSubset, pageSubset, "...") // Show page subset (...)

	@buildLinks(ViewBag.TotalPages - maxPages + 3, ViewBag.TotalPages, null) // Show last pages

		return; // Exit
	}

	if (pagesBefore <= 4)
	{
	@buildLinks(1, maxPages - 2, null) // Show 1st pages


		int pageSubset = maxPages + 2 < ViewBag.TotalPages ? maxPages + 2 : ViewBag.TotalPages - 1;
	@buildLinks(pageSubset, pageSubset, "...") // Show page subset (...)

	@buildLinks(ViewBag.TotalPages, ViewBag.TotalPages, null) // Show last page

		return; // Exit

	}

	if (pagesAfter > 4)
	{
	@buildLinks(1, 1, null) // Show 1st pages

		int pageSubset1 = ViewBag.CurrentPage - 7 > 1 ? ViewBag.CurrentPage - 7 : 2;
		int pageSubset2 = ViewBag.CurrentPage + 7 < ViewBag.TotalPages ? ViewBag.CurrentPage + 7 : ViewBag.TotalPages - 1;

	@buildLinks(pageSubset1, pageSubset1, pageSubset1 == ViewBag.CurrentPage - 4 ? null : "...") // Show 1st page subset (...)

	@buildLinks(ViewBag.CurrentPage - 3, ViewBag.CurrentPage + 3, null) // Show middle pages

		// Show 2nd page subset (...)
		// only show ... if page is contigous to the previous one.
	@buildLinks(pageSubset2, pageSubset2, pageSubset2 == ViewBag.CurrentPage + 4 ? null : "...")
	@buildLinks(ViewBag.TotalPages, ViewBag.TotalPages, null) // Show last page

		return; // Exit

	}    
}*@

@helper sortLink(string name, int id)
{
	<a href="@Url.Action("OAExisting", "OA", new { sortby = id, isasc = (id == ViewBag.sortBy ? (!@ViewBag.isAsc).ToString().ToLower() : true) })">@name</a> 
	if (id == ViewBag.sortBy)
	{
	<span class="arrow @(ViewBag.isAsc ? "up" : "down")"></span>
	}
}
@* End Of Paging & Sorting Code *@

<link href="~/Content/bootstrap/css/bootstrap.css" rel="stylesheet" />
<link href="~/Content/bootstrap/css/bootstrap-responsive.css" rel="stylesheet" />
<link href="~/Content/bootstrap/css/MDB.css" rel="stylesheet" />
<link href="~/Content/bootstrap/css/print.css" media="print" rel="stylesheet" />
<link href="~/Content/bootstrap/css/jquery.ui.autocomplete.css" rel="stylesheet" />
<script src="~/Content/bootstrap/js/jquery1.8.2.min.js"></script>
<script src="~/Content/bootstrap/js/jQuery%20UI%201.9.2.js"></script>
<script type="text/javascript">
	$(document).ready(function () {
		$("#printbutton").click(function () {
			$("#printbutton").visible = false;
			$("#savebutton").visible = false;
			self.focus()
			self.print()
		});
	});
</script>

<script type="text/javascript">
	$(document).ready(function () {
		$("#cunam").autocomplete({
			source: function (request, response) {
				$.ajax({
					url: "/OA/Autocompletemach",
					type: "POST",
					dataType: "json",
					data: { term: request.term },
					success: function (data) {
						response($.map(data, function (item) {
							return { label: item.OrganizationName, value: item.OrganizationName };
						}))

					}
				})
			},
			messages: {
				noResults: "", results: ""
			}
		});
	});
</script>
<div class="bcgr" style="min-height: 580px;">
	<div style="background: gray; padding-bottom: 15px">
		<p class="txtft">Order Status Tracker</p>
	</div>
<form action="@Url.Action("MachineDispatchTracker", "OA")" method="get">
	<div class="row" style="padding-top: 10px">
		<div class=" row show-grid">
			<div class="span12 pad ">
				<div class="span3 ">
					<div class="control-group ">
						<label class="control-label fntst ">Customer Name</label>
						<div class="controls ">
							<input type="text" class="fntst excus" value="@ViewBag.Search" id="cunam" name="cunam" placeholder="Customer Name">
						</div>
					</div>
				</div>
				<div class="span3">
					<div class="cent3">
						@*<input type="submit" value="Get Details" class="btn btn-info existingcustomer" onclick="javascript: return updateparent();" />*@
						<input type="submit" value="Get Details" id="gd" class="btn btn-info existingcustomer" />
						@*onclick="javascript: return updateparent();"*@
					</div>
				</div>
			</div>
		</div>
	</div>
</form>

	@* Status Chances *@
	@if (TempData["status"] != null)
	{
		<p style="color: red; font-weight: 900; padding-left: 170px">@TempData["status"]</p>
	}
@* Status Chances *@
	@if (TempData["nostatus"] != null)
	{
		<p style="color: red; font-weight: 900; padding-left: 170px">@TempData["nostatus"]</p>
	}

	<div class="row">
		<div class=" row show-grid">
			<div style="padding-top: 30px; padding-left: 65px">
				<table class="table-hover" style="width: 1300px">
					<thead>
						<tr style="background: #BBBEBD">
							<th style="width: 70px; text-align: center" class="fntst cal botbor">Serial No</th>
							<th style="width: 100px; text-align: center" class="fntst cal botbor">OA Number</th>
							<th style="width: 130px; text-align: center" class="fntst cal botbor">Customer Name</th>
							<th style="width: 70px; text-align: center" class="fntst cal botbor">Invoice Date</th>
							<th style="width: 100px; text-align: center" class="fntst cal botbor">Invoice Number</th>
							<th style="width: 250px; text-align: center" class="fntst cal botbor">Dispatch Details</th>
							<th style="width: 100px; text-align: center" class="fntst cal botbor">LR Number</th>
						</tr>
					</thead>
					@foreach (var item in Model)
					{
						<tr>
							<td style="text-align: center;">
								@slno
							</td>
							<td style="text-align: center;">
								<label class="fntst">@item.OANumber</label>
							</td>
							<td style="text-align: center;">
								<label class="fntst">@item.MDBGeneralData.OrganizationName</label>
							</td>
							<td style="text-align: center;">
								<label class="fntst">@Html.DisplayFor(modelitem => item.InvoiceDate)</label>
							</td>
							<td style="text-align: center;">
								<label class="fntst">@item.InvoiceNumber</label>
								@*<label class="fntst">@Html.DisplayFor(modelitem => item.OADate)</label>*@
							</td>
							<td style="text-align: center;">
								<label class="fntst">@item.Transporter</label>
							</td>
							<td style="text-align: center;">
								<label class="fntst">@item.LRNumber</label>
							</td>
						</tr>
						slno = slno + 1;
					}
				</table>
			</div>
			<div class="row" style="padding-top: 20px; padding-left: 300px; padding-bottom: 20px">
				<div class=" row show-grid">
					<div class="span10">
						<div class="span3 cent">
							<button class="btn btn-large btn-success printButtonClass" id="printbutton" type="button">Print</button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
